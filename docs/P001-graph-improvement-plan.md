# P001: 지식그래프 개선 계획

**작성일:** 2026-02-21
**상태:** 📋 계획 수립 → 실행 대기

## 배경

T003 품질 분석 결과, 두 가지 구조적 개선 포인트 식별:
1. 중복 노트 이름 297개 (동일 이름, 다른 경로)
2. 댕글링 참조 294개 (위키링크 타겟 파일 없음)

## 개선 1: 댕글링 참조 → 스텁 노트 자동 생성

### 문제
- `[[Neo4j]]`, `[[Docker]]` 등 위키링크가 존재하지 않는 파일을 참조
- 그래프에서 `unknown` + `dangling=True` 노드로 생성됨
- 143개 1-노드 고립 컴포넌트의 원인

### 해결 방안
- 빈도 높은 댕글링 참조 상위 50개에 대해 스텁 노트 자동 생성
- 위치: `03.RESOURCES/스텁/` 하위
- 내용 구조:
  ```yaml
  ---
  type: stub
  tags: [auto-generated]
  created: YYYY-MM-DD
  ---
  # {노트명}
  
  > 이 노트는 자동 생성된 스텁입니다. 내용을 추가해주세요.
  
  ## 참조하는 노트
  - [[참조1]]
  - [[참조2]]
  ```
- daily_enrich에 "댕글링 해소" 단계 추가 (신규 댕글링 감지 시 자동 생성)

### 기대 효과
- unknown 노드 감소 (294 → ~50 이하)
- 고립 컴포넌트 감소 (162 → ~30 이하)
- 그래프 연결성 향상 → 검색 품질 향상

### 예상 공수
- 스텁 생성 스크립트: 30분
- daily_enrich 통합: 15분
- 테스트 + 검증: 15분
- **총 1시간**

### 리스크
- 낮음. 스텁 노트는 볼트에 추가만 하므로 기존 데이터에 영향 없음
- OneDrive 동기화로 아이패드에 자동 반영

---

## 개선 2: 경로 기반 고유키 도입

### 문제
- 다른 폴더에 동일 파일명 존재 시 그래프에서 하나로 병합됨
- 예시:
  - `00.MAIBOT/_DASHBOARD.md` + `03.MAIAX/_DASHBOARD.md` → 동일 `_DASHBOARD` 노드
  - `KANBAN.md`가 여러 프로젝트에 존재 → 허브 노드로 과대 평가
- 297개 이름에서 929개 중복 파일 발생

### 해결 방안
- `parser.py`의 노드 키를 파일명 → **볼트 상대 경로** 기반으로 변경
- 위키링크 해석: Obsidian의 shortest-path 매칭 로직 구현
  - `[[_DASHBOARD]]` → 현재 폴더 우선, 없으면 전체 검색
- 영향 범위:
  - `parser.py`: `name` 필드 변경
  - `graph_builder.py`: 노드 키 변경
  - `hybrid_search.py`: 검색 결과 키 변경
  - `embedder.py`: 임베딩 캐시 키 변경
  - `cache.py`: 체크섬 키 변경
  - `enricher.py`, `content_linker.py`: 노트 식별자 변경

### 기대 효과
- 데이터 정확성 향상 (노드 2,533 → ~3,100+ 정확한 노드)
- 프로젝트별 KANBAN, _DASHBOARD 등 올바른 분리
- 검색 결과의 경로 정보로 컨텍스트 명확화

### 예상 공수
- 파서/빌더 리팩토링: 1시간
- 위키링크 해석 로직: 30분
- 전체 모듈 키 변경: 30분
- 테스트 + 검증: 30분
- **총 2~3시간**

### 리스크
- 중간. 모든 모듈의 노드 키가 변경되므로:
  - 기존 임베딩 캐시 무효화 → 풀 재임베딩 필요 (~46초)
  - 기존 그래프 캐시 무효화 → 풀 리빌드 필요
  - 검색 결과 형식 변경 → MAIBOT 스킬/스크립트 수정 필요

---

## 실행 순서

| 순서 | 작업 | 우선순위 | 상태 |
|------|------|---------|------|
| 1 | 댕글링 스텁 생성 스크립트 개발 | 🥇 높음 | ⬜ 대기 |
| 2 | daily_enrich에 스텁 생성 단계 통합 | 🥇 높음 | ⬜ 대기 |
| 3 | 스텁 생성 실행 + 그래프 재빌드 + 검증 | 🥇 높음 | ⬜ 대기 |
| 4 | 경로 기반 고유키 설계 (위키링크 해석 포함) | 🥈 중간 | ⬜ 대기 |
| 5 | 전체 모듈 리팩토링 | 🥈 중간 | ⬜ 대기 |
| 6 | 풀 리빌드 + 재임베딩 + 검증 | 🥈 중간 | ⬜ 대기 |

---

_작성: MAIBOT | 승인 대기: 지니님_
